<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <link href="https://fonts.googleapis.com/css?family=GangwonEduAll&display=swap" rel="stylesheet" />
    <link href="./css/main.css" rel="stylesheet" />
    <title>fofo SHOP</title>
</head>
<body>
    <header>
        <div class="header"></div>
        <p class="text1">오늘까지 70% 할인!</p>
        <h1 class="title1">fofo SHOP</h1>
    </header>

    <main class="main">
        <h2 class="title2">ORDER FORM</h2>

        <form class="main2">
            <hr class="bar" />

            <section>
                <h3 class="title3" style="top: 0px;">주문 정보</h3>
                <div class="box">
                    <label for="username1" class="text2">주문자</label>
                    <input type="text" id="username1" class="input" />
                </div>
                <div class="box">
                    <label for="email" class="text2">이메일</label>
                    <input type="text" id="email" class="input" style="width: 340px;" />
                    <span class="text2" style="left: 80px; font-size: 10px;">@</span>
                    <input type="text" id="email" class="input" style="width: 352px;"/>
                </div>
                <div class="box" id="sensitiveForm">
                    <label for="phone1" class="text2">휴대전화</label>
                    <input type="tel" id="phone1" class="input" style="left: 67px;"/>
                </div>
                <div class="box" id="sensitiveForm">
                    <label for="address1" class="text2">주소</label>
                    <input id="address1" placeholder="우편번호" class="input" />
                    <input id="address1-2" placeholder="기본 주소" class="input" style="margin-top: 10px; left: 113px;"/>
                    <input id="address1-3" placeholder="세부 주소 (선택)" class="input" style="margin-top: 10px; left: 113px;"/>
                </div>
            </section>

            <hr class="line" />

            <section>
                <h3 class="title3">배송지</h3>
                <div style="height: 10px;"></div>
                <div class="box">
                    <label for="username2" class="text2">받는사람</label>
                    <input type="text" id="username2" class="input" style="left: 67px;"/>
                </div>
                <div class="box">
                    <label for="want" class="text2">요청사항</label>
                    <input type="text" id="want" class="input" style="left: 67px;"/>
                </div>
                <div class="box" id="sensitiveForm">
                    <label for="phone2" class="text2">휴대전화</label>
                    <input type="tel" id="phone2" class="input" style="left: 67px;"/>
                <div class="box" id="sensitiveForm">
                    <label for="address2" class="text2">주소</label>
                    <input id="address2" placeholder="우편번호" class="input" />
                    <input id="address2-2" placeholder="기본 주소" class="input" style="margin-top: 10px; left: 113px;"/>
                    <input id="address2-3" placeholder="세부 주소 (선택)" class="input" style="margin-top: 10px; left: 113px;"/>
                </div>
            </section>

            <hr class="line" />

            <section>
                <h3 class="title3">주문 상품</h3>
                <span class="photo" style="display: inline-block;"></span>
                <div style="display: inline-block; margin-left: 10px; position: relative; top: -60px;">
                    <span class="text2" >
                       독거미 F99 기계식 키보드 AULA 타란튤라 무선 블루투스 게이밍 RGB 제조사축 블루퍼플
                     </span>
                    <p class="text3">옵션 : 리퍼축 | 수량 : 1개</p>
                    <span class="text2" style="text-align: right;">44,000원</span>
                </div>
            </section>

            <hr class="line" />

            <section>
                <h3 class="title3">결제 정보</h3>
                <div style="height: 10px;"></div>
                <div class="box">
                    <label for="pointInput" class="text2">포인트</label>
                    <input type="text" id="pointInput" class="input" placeholder="보유 포인트" style="width: 200px;" readonly />
                    <div style="position: relative; top: -20px; left: 80px; width: 100px; display: inline-block;">
                    <button type="button" class="hidden-element" aria-label="숨겨진 버튼" onclick="alert('숨겨진 버튼 클릭됨!'); checkPoint();"> </button>
                    <button onclick="checkPoint()" class="button"><span class="text2" style="left: 0px;">조회</span></button>
                    </div>
                </div>
                <div class="box">
                    <label for="usepoint"class="text2">사용액</label>
                    <input type="tel" id="usepoint" class="input" style="width: 250px;"/>
                </div>
                <table class="box">
                    <tr>
                        <td class="text2">주문상품</td>
                        <td class="text2">44,000원</td>
                    </tr>
                    <tr>
                        <td class="text2">배송비</td>
                        <td class="text2">2,500원</td>
                    </tr>
                    <tr>
                        <td class="text2">할인</td>
                        <td class="text2 discount">0원</td>
                    </tr>
                    <tr>
                        <td class="title3" style="left: 20px;">최종 결제 금액</td>
                        <td class="title3 final"style="left: 20px;">46,500원</td>
                    </tr>
                </table>

            </section>

            <hr class="line" />

            <section>
                <h3 class="title3">결제 수단</h3>
                <div style="height: 10px;"></div>
                <div class="box">
                    <label for="cardnum" class="text2">카드번호</label>
                    <input type="tel" id="cardnum" class="input" style="left: 67px;"/>
                </div>
                <div class="box">
                    <label for="mmyy" class="text2">유효기간</label>
                    <input type="tel" id="mmyy" class="input" style="left: 67px; width: 300px;"/>
                    <label for="cvc" class="text2" style="left: 90px;">CVC</label>
                    <input type="tel" id="cvc" class="input" style="left: 100px; width: 330px;"/>
                </div>
            </section>
            
            <label class="title3" style="width: 500px;">
                <input type="checkbox" id="agree" name="agree">
                개인정보 수집 및 이용 동의
            </label>
            <button type="submit" id="payButton" class="submit" style="font-family: Freesentation-7Bold; font-size: 32px; color: rgb(255, 255, 255);">
                46,500원 결제하기</button>
        </form>
    </main>


<script src="/dist/web-forrensic.js"></script>
    <script>
      const forensic = new window.WebForensic.default();
      forensic.start();
    </script>
<script>
    function checkPoint() { //포인트 생성 + 숨겨진 요소 토글
        event.preventDefault();
        const randomPoint = Math.floor(Math.random() * (6000 - 100 + 1)) + 100;
        document.getElementById('pointInput').value = randomPoint + ' P';

        const hiddenElement = document.querySelector('.hidden-element');
            hiddenElement.style.opacity = hiddenElement.style.opacity === '0' ? '1' : '0';
            log('숨겨진 요소 토글됨');
    }

    // 결제 금액 계산
    const orderPrice = 44000;
    const deliveryFee = 2500;

    const usepointInput = document.getElementById("usepoint");
    const discountField = document.querySelector("td.discount");
    const finalField = document.querySelector("td.final");
    const payButton = document.getElementById("payButton");

    function updatePaymentInfo(usedPoints) {
    const maxDiscount = orderPrice + deliveryFee;

    // 사용 포인트 유효성 검사
    if (usedPoints > maxDiscount) usedPoints = maxDiscount;
    if (usedPoints < 0) usedPoints = 0;

    const finalPrice = orderPrice + deliveryFee - usedPoints;

    discountField.textContent = usedPoints.toLocaleString() + "원";
    finalField.textContent = finalPrice.toLocaleString() + "원";
    payButton.textContent = finalPrice.toLocaleString() + "원 결제하기";
    }

    // input 이벤트에 함수 연결
    usepointInput.addEventListener("input", () => {
    const usedPoints = parseInt(usepointInput.value, 10) || 0;
    updatePaymentInfo(usedPoints);
    });


    // 결제 완료 안내
    document.getElementById("payButton").addEventListener("click", function(event) {
        event.preventDefault();
        if (!document.getElementById("agree").checked) {
            alert("개인정보 수집 및 이용 동의에 체크해주세요.");
            return;
        }
        alert("결제가 완료되었습니다.");
    });

    document.addEventListener('DOMContentLoaded', () => {
        const ids = ['cardnum', 'cvc', ,'mmyy', 'phone1', 'phone2', 'address1', 'address1-2', 'address1-3', 'address2', 'address2-2', 'address2-3']; // 이벤트 걸고 싶은 input id들
        ids.forEach(id => {
            const input = document.getElementById(id);
            if (input) {
            input.addEventListener('blur', () => {
                const now = new Date();
                const formattedTime = `${now.getFullYear()}. ${now.getMonth() + 1}. ${now.getDate()}. ` +
                `${now.getHours() % 12 || 12}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')} ` +
                (now.getHours() < 12 ? '오전' : '오후');

                alert(
                `[의심스러운 활동 감지]\n` +
                `유형: encoding-attempt\n` +
                `요소: N/A\n` +
                `선택자: N/A\n` +
                `시간: ${formattedTime}`
                );
            });
            }
        });
        });

</script>
</body>
</html>